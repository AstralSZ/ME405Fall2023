<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME405 Romi Project: Software</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="Format.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME405 Romi Project
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('subsystem2.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Software</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#subsystem2section1">Paradigm</a></li>
<li class="level1"><a href="#subsystem2section2">Software Design</a></li>
<li class="level1"><a href="#subsystem2section3">Solving the Maze</a></li>
<li class="level1"><a href="#subsystem2section4">Task Diagram and State Machines</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="subsystem2section1"></a>
Paradigm</h1>
<p>As for the main style of coding in this class, we implemented cooperative multi-tasking using the cotask and task share classes written by Professor Ridgely. We have 2 tasks in our design one of which is for the user interface allowing the user to start the robot and check the IMU. Meanwhile, the hardware task runs most of the logic for navigating the obstacle and controls the hardware which includes the motor, encoder, line sensors, and IMU of the robot. It has the highest priority and is run at a period of 5ms while the user interface is ran at a much slower rate of a period of 100ms and a lower priority.Within the hardware task, there is a mini "State machine" that controls the logic of the maze solver and its diagram is shown below.</p>
<h1><a class="anchor" id="subsystem2section2"></a>
Software Design</h1>
<p>For interesting design decisions we made, in order to avoid blocking code by putting a sleep, we used the timer module to check the time elapsed through each update which was espcially prevalent for the pre-planned movement around the wall. In addition, using the timer improved the accuracy for calculating both the position and speeds of the motor. That would also allow us to check whether or not the button was pressed at any time to stop the robot. We were also able to implemant dead-reckoning using the equations from HW 3 and Euler Angles readings from the IMU to provide the heading information required to calculate the instantanous velocity in the x and y direction. Then we created a class to do the function as provided below and used the time differences between each call for the time step to predict the x and y position. Also, the encoder was used to find the angular velocities of each individual wheels as wheel.Then to follow the line we are using a proportional control system to keep the sensor in the middle of the line. We implmented it by first reading the middle sensor to see what the value would be reading if the Romi was squarely on the line. We used that ADC value as the reference point and set the speeds of the wheel based on the difference of the current value compared to the reference one.</p>
<h1><a class="anchor" id="subsystem2section3"></a>
Solving the Maze</h1>
<p>For the logic of the obstacle solver there is a small finite state machine it in our design though it is not a seperate class which is presented in a bulleted list.</p>
<ol type="1">
<li>Follow line</li>
<li>Detect wall</li>
<li>Navigate wall</li>
<li>Follow line</li>
<li>Detect finish line</li>
<li>Traverse y direction to zero</li>
<li>Rotate and traverse x direction and move to zero</li>
</ol>
<p>Much of the rotation is controlled by the IMU in which our code takes the current heading reading and uses it as the reference angle. Also that is how the math is done to calculate the x and y position of Romi.</p>
<h1><a class="anchor" id="subsystem2section4"></a>
Task Diagram and State Machines</h1>
<p>Task Diagram and User Interface State Machine <img src="TandF1.jpg" alt="Side View" width="800" height="900" class="inline"/> Hardware State Machine and Driver "State Machine" <img src="F2andF3.jpg" alt="Front View" width="800" height="900" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
